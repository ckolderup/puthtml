<% if current_user %>
  <div id="user" class="unit">
    <ul class="status">
      <li class="name"><%= current_user.name %></li>
      <li class="profile">
        <a href="/<%= current_user.name %>" target="_blank">
          Visit your profile
        </a>
      </li>
      <li class="api-key">
        <details>
          <summary>Show API key</summary>
          <tt><%= current_user.api_key %></tt>
          <form action="/settings/api-key" method="post">
            <button>Reset API key</button>
          </form>
        </details>
      </li>
      <li class="sign-out"><a class="sign-out" href="/sign-out">Sign out</a></li>
    </p>

    <form method="post" action="/" id="form_create" enctype="multipart/form-data">
      <ul>
        <li>
          <label for="file">File</label>
          <input type="file" name="file" id="file">
        </li>
        <li>
          <label for="path">Path (leave blank for auto)</label>
          <div class="input-with-extra">
            <span>/<%= current_user.name %>/</span>
            <input type="text" name="path" id="path">
          </div>
        </li>
      </ul>

      <button>Put HTML</button>
    </form>
  </div>
<% else %>
  <p class="unit"><a class="sign-in" href="/auth/twitter">Sign in with Twitter</a></p>
<% end %>

<% if @documents.size > 0 %>
  <div class="unit">
    <h2>Latest documents</h2>

    <ul id="documents">
      <% @documents.each do |doc| %>
        <li data-user="<%= doc.user_name %>">
          <a class="title" href="<%= doc.path %>" target="_blank">
            <span class="meta">
              <em class="user"><%= doc.user.try(:name) || doc.user_name %></em>
              <% if doc.partial_path.present? %><small class="partial-path"><%= doc.partial_path.split('/').map{ |part| "<span>#{ part }</span>" }.join ' ' %></small><% end %>
            </span>
            <strong class="title"><%= doc.title %></strong>
          </a>

          <aside>
            <span class="time"><%= doc.updated_at.strftime('%b %-e %I:%-m%P') %></span>
            <a class="edit" href="/<%= doc.path %>?edit"><%= (doc.user == current_user) ? 'Edit' : 'Copy' %></a>
          </aside>
        </li>
      <% end %>
    </ul>
  </div>
<% end %>
